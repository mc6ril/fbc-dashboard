---
Generated: 2025-01-27 14:30:22
Ticket Number: 24
---

# Add React Query mutation hooks for product create and update

-   Type: Feature
-   Priority: High
-   Story Points: 2
-   Labels: hooks, react-query, products, mutations
-   Git Branch: feat/fbc-24-product-mutation-hooks

## Description

Add React Query mutation hooks for creating and updating products. These hooks will connect the UI layer to the usecases, handle cache invalidation, and provide loading/error states.

**Current state:**

-   `useProducts` query hook exists for listing products
-   `createProduct` and `updateProduct` usecases exist (from ticket #23)
-   No mutation hooks for products yet

**Business requirement:**

-   UI needs mutation hooks to create and update products
-   Cache must be invalidated after mutations to keep data fresh
-   Loading and error states must be available for UI feedback

## User Story

As a developer, I want React Query mutation hooks for product operations so that the UI can create and update products with proper cache management and loading states.

## Acceptance Criteria

### Mutation Hooks Implementation

-   [ ] Create `useCreateProduct` mutation hook in `src/presentation/hooks/useProducts.ts`
    -   Uses `useMutation` from React Query
    -   Calls `createProduct` usecase with `productRepositorySupabase`
    -   Takes `Omit<Product, 'id'>` as mutation input
    -   Invalidates `queryKeys.products.all()` on success
    -   Returns mutation object with `mutate`, `mutateAsync`, `isPending`, `error`, `data`
-   [ ] Create `useUpdateProduct` mutation hook in `src/presentation/hooks/useProducts.ts`
    -   Uses `useMutation` from React Query
    -   Calls `updateProduct` usecase with `productRepositorySupabase`
    -   Takes `{ id: ProductId, updates: Partial<Product> }` as mutation input
    -   Invalidates `queryKeys.products.all()` on success
    -   Returns mutation object with `mutate`, `mutateAsync`, `isPending`, `error`, `data`
-   [ ] Update `queryKeys` in `src/presentation/hooks/queryKeys.ts` if needed
    -   Ensure `queryKeys.products.all()` exists for invalidation
    -   Add product detail keys if needed for future use

### Hook Patterns

-   [ ] Follow same patterns as `useSignIn`, `useSignUp` from `useAuth.ts`
-   [ ] Use `useQueryClient` for cache invalidation
-   [ ] Invalidate queries in `onSuccess` callback
-   [ ] Export hooks for use in components

## Technical Considerations

### Architecture Layers

-   **Usecases layer**: `createProduct` and `updateProduct` usecases (from ticket #23)
-   **Infrastructure layer**: `productRepositorySupabase` (already exists)
-   **Presentation layer**: Add mutation hooks

### React Query Patterns

Follow the same patterns as auth hooks:

-   **useCreateProduct**:

    ```typescript
    export const useCreateProduct = () => {
        const queryClient = useQueryClient();
        return useMutation({
            mutationFn: (product: Omit<Product, "id">) => createProduct(productRepositorySupabase, product),
            onSuccess: () => {
                queryClient.invalidateQueries({
                    queryKey: queryKeys.products.all(),
                });
            },
        });
    };
    ```

-   **useUpdateProduct**:
    ```typescript
    export const useUpdateProduct = () => {
        const queryClient = useQueryClient();
        return useMutation({
            mutationFn: ({ id, updates }: { id: ProductId; updates: Partial<Product> }) => updateProduct(productRepositorySupabase, id, updates),
            onSuccess: () => {
                queryClient.invalidateQueries({
                    queryKey: queryKeys.products.all(),
                });
            },
        });
    };
    ```

### Cache Invalidation

-   Invalidate `queryKeys.products.all()` after create/update
-   This ensures the products list refreshes after mutations
-   Future: Could add optimistic updates for better UX

### Error Handling

-   Errors from usecases will be available in `error` property
-   UI components should handle errors appropriately
-   Don't swallow errors in hooks

## Definition of Done

-   [ ] `useCreateProduct` mutation hook implemented
-   [ ] `useUpdateProduct` mutation hook implemented
-   [ ] Hooks invalidate products list query on success
-   [ ] Hooks follow React Query best practices
-   [ ] Hooks follow same patterns as existing mutation hooks
-   [ ] JSDoc documentation added for both hooks
-   [ ] Build/lint green
-   [ ] No TypeScript errors
-   [ ] Code review approved

## Related Components

### Presentation - Hooks

-   `src/presentation/hooks/useProducts.ts` - Product hooks (add mutations)
-   `src/presentation/hooks/queryKeys.ts` - Query keys (verify/update if needed)

### Usecases (Dependency)

-   `src/core/usecases/product.ts` - Product usecases (`createProduct`, `updateProduct`) - from ticket #23

### Infrastructure

-   `src/infrastructure/supabase/productRepositorySupabase.ts` - Repository implementation (reference)

### Reference Hooks

-   `src/presentation/hooks/useAuth.ts` - Auth hooks (`useSignIn`, `useSignUp`) - reference for mutation patterns
-   `src/presentation/hooks/useActivities.ts` - Activities hooks - reference for query patterns

## Dependencies

-   **Ticket #23**: `createProduct` and `updateProduct` usecases must be implemented first
-   Product repository (already exists)
-   React Query setup (already exists)
-   Query keys structure (already exists)

## Notes

-   This ticket focuses only on the hooks layer (data fetching/mutations)
-   No UI components in this ticket
-   Follow the same patterns as auth mutation hooks for consistency
-   Cache invalidation ensures UI stays in sync after mutations
