---
Generated: 2025-01-27 14:30:22
Ticket Number: 22
Status: Split into tickets #23, #24, #25
---

# Build catalog page with product list, create, and update functionality

**⚠️ This ticket has been split into smaller, more digestible tickets:**

-   **Ticket #23**: Add createProduct and updateProduct usecases (Core layer)
-   **Ticket #24**: Add React Query mutation hooks for product create and update (Hooks layer)
-   **Ticket #25**: Build catalog page UI with product list, create, and update (UI layer)

Please refer to the individual tickets for implementation details.

-   Type: Feature
-   Priority: High
-   Story Points: 8
-   Labels: ui, catalog, products, crud, forms
-   Git Branch: feat/fbc-22-catalog-page-product-crud

## Description

Build a complete catalog page that allows users to visualize their product list, add new products, and update existing products. The catalog page should follow the same patterns as the Activities page, providing a consistent user experience across the dashboard.

**Current state:**

-   Catalog page exists at `/dashboard/catalog` but is just a placeholder
-   Product repository has `create` and `update` methods implemented
-   `useProducts` hook exists for listing products
-   No usecases for creating or updating products yet
-   No React Query mutation hooks for products yet
-   No UI components for product management

**Business requirement:**

-   Users need to view all products in a table format
-   Users need to add new products to the catalog
-   Users need to edit existing product information (name, type, coloris, pricing, stock, weight)
-   Product management should be accessible and follow the same UX patterns as Activities

## User Story

As a user, I want to view, add, and update products in the catalog so that I can manage my product inventory and pricing information.

## Acceptance Criteria

### Domain & Usecases Layer

-   [ ] Create `createProduct` usecase in `src/core/usecases/product.ts`
    -   Validates product data using domain validation
    -   Delegates to repository for persistence
    -   Returns created product with generated ID
-   [ ] Create `updateProduct` usecase in `src/core/usecases/product.ts`
    -   Validates product updates
    -   Checks product exists before updating
    -   Delegates to repository for persistence
    -   Returns updated product
-   [ ] Add unit tests for `createProduct` usecase in `__tests__/core/usecases/product.test.ts`
-   [ ] Add unit tests for `updateProduct` usecase in `__tests__/core/usecases/product.test.ts`

### Presentation Layer - Hooks

-   [ ] Create `useCreateProduct` mutation hook in `src/presentation/hooks/useProducts.ts`
    -   Uses `useMutation` from React Query
    -   Calls `createProduct` usecase
    -   Invalidates products list query on success
    -   Returns mutation object with `mutate`, `isPending`, `error`
-   [ ] Create `useUpdateProduct` mutation hook in `src/presentation/hooks/useProducts.ts`
    -   Uses `useMutation` from React Query
    -   Calls `updateProduct` usecase
    -   Invalidates products list query on success
    -   Returns mutation object with `mutate`, `isPending`, `error`
-   [ ] Update `queryKeys` in `src/presentation/hooks/queryKeys.ts` if needed for product mutations

### Presentation Layer - Components

-   [ ] Create `ProductsTable` component in `src/presentation/components/catalog/ProductsTable/`
    -   Displays products in a table format
    -   Shows: name, type, coloris, unitCost, salePrice, stock, weight
    -   Includes edit action button for each product
    -   Handles loading and error states
    -   Uses SCSS module for styling
    -   Follows accessibility guidelines (ARIA labels, semantic HTML)
-   [ ] Create `ProductForm` component in `src/presentation/components/catalog/ProductForm/`
    -   Reusable form for both create and edit modes
    -   Fields: name (text), type (select with ProductType enum), coloris (text), unitCost (number), salePrice (number), stock (number), weight (number, optional)
    -   Validates inputs and displays errors accessibly
    -   Uses SCSS module for styling
    -   Follows accessibility guidelines (labels, error messages, ARIA attributes)
-   [ ] Update `CatalogPage` component in `src/app/dashboard/catalog/page.tsx`
    -   Fetches products using `useProducts` hook
    -   Displays `ProductsTable` with products data
    -   Includes "Add Product" button linking to `/dashboard/catalog/new`
    -   Handles loading and error states
    -   Uses SCSS module for styling (create `page.module.scss`)
-   [ ] Create `NewProductPage` component in `src/app/dashboard/catalog/new/page.tsx`
    -   Uses `ProductForm` component in create mode
    -   Uses `useCreateProduct` mutation hook
    -   Redirects to catalog page on success
    -   Displays success/error feedback accessibly
    -   Uses SCSS module for styling
-   [ ] Create `EditProductPage` component in `src/app/dashboard/catalog/[id]/edit/page.tsx`
    -   Fetches product by ID (may need `getProductById` usecase and hook)
    -   Uses `ProductForm` component in edit mode with pre-filled data
    -   Uses `useUpdateProduct` mutation hook
    -   Redirects to catalog page on success
    -   Displays success/error feedback accessibly
    -   Uses SCSS module for styling
-   [ ] All components follow project conventions:
    -   Arrow function with export default
    -   Props typed with `type` (not `interface`)
    -   Use `React.memo` for expensive components
    -   Use `useCallback` for event handlers
    -   Use `useMemo` for expensive calculations

### Styling

-   [ ] Create `src/app/dashboard/catalog/page.module.scss` with styles following BEM methodology
-   [ ] Create `src/app/dashboard/catalog/new/page.module.scss` with styles
-   [ ] Create `src/app/dashboard/catalog/[id]/edit/page.module.scss` with styles
-   [ ] Create `src/presentation/components/catalog/ProductsTable/ProductsTable.module.scss` with styles
-   [ ] Create `src/presentation/components/catalog/ProductForm/ProductForm.module.scss` with styles
-   [ ] All styles use variables from `styles/variables/*` (no hardcoded values)
-   [ ] All class names use kebab-case with BEM methodology

### Optional Enhancements (Future)

-   [ ] Add product search/filter functionality
-   [ ] Add pagination for large product lists
-   [ ] Add product deletion functionality
-   [ ] Add bulk operations (bulk update, bulk delete)

## Technical Considerations

### Architecture Layers

-   **Domain layer**: Product type already exists with all required fields (name, type, coloris, unitCost, salePrice, stock, weight)
-   **Usecases layer**: Need to add `createProduct` and `updateProduct` usecases
    -   `createProduct`: Validates product data, calls repository.create
    -   `updateProduct`: Validates updates, checks product exists, calls repository.update
-   **Infrastructure layer**: Repository methods already implemented (`create`, `update`)
-   **Presentation layer**: Need to build UI components and hooks
    -   Hooks: `useCreateProduct`, `useUpdateProduct` (mutations)
    -   Components: `ProductsTable`, `ProductForm`, `CatalogPage`, `NewProductPage`, `EditProductPage`

### Data Flow

```
UI (CatalogPage)
    ↓ calls
React Query Hook (useProducts) - for listing
    ↓ calls
Usecase (listProducts)
    ↓ calls
Repository (productRepositorySupabase.list)

UI (NewProductPage/EditProductPage)
    ↓ calls
React Query Mutation Hook (useCreateProduct/useUpdateProduct)
    ↓ calls
Usecase (createProduct/updateProduct)
    ↓ calls
Repository (productRepositorySupabase.create/update)
```

### Component Structure

Follow the same patterns as Activities page:

-   **CatalogPage** (`/dashboard/catalog`):

    -   Header with title and "Add Product" button
    -   ProductsTable component
    -   Loading and error states

-   **NewProductPage** (`/dashboard/catalog/new`):

    -   ProductForm component (create mode)
    -   Form submission via useCreateProduct mutation
    -   Success redirect to catalog page

-   **EditProductPage** (`/dashboard/catalog/[id]/edit`):
    -   Fetch product by ID (may need `getProductById` usecase/hook)
    -   ProductForm component (edit mode) with pre-filled data
    -   Form submission via useUpdateProduct mutation
    -   Success redirect to catalog page

### Product Form Fields

-   **name** (text, required): Product name/description
-   **type** (select, required): ProductType enum (SAC_BANANE, POCHETTE_ORDINATEUR, etc.)
-   **coloris** (text, required): Color variation
-   **unitCost** (number, required, > 0): Cost per unit
-   **salePrice** (number, required, > 0): Selling price per unit
-   **stock** (number, required, >= 0): Current stock level
-   **weight** (number, optional, > 0 if provided): Weight in grams

### Validation

-   Usecases validate product data using domain validation (`isValidProduct`)
-   Form components should validate inputs before submission
-   Display validation errors accessibly (ARIA labels, error messages)
-   Repository enforces database constraints (positive prices, non-negative stock, etc.)

### Accessibility

-   All interactive elements have proper ARIA labels
-   Form fields have associated labels and error messages
-   Error messages use `role="alert"` for screen reader announcements
-   Success messages use `aria-live="polite"` for announcements
-   Table has proper semantic structure with `<thead>`, `<tbody>`, `<th>` with scope
-   Buttons have descriptive `ariaLabel` props

### React Query Patterns

-   **Mutations**: Use `useMutation` with `onSuccess` to invalidate products list query
-   **Query invalidation**: Invalidate `queryKeys.products.all()` after create/update
-   **Loading states**: Use `isPending` from mutation hooks
-   **Error handling**: Display errors accessibly, don't swallow errors

## Definition of Done

-   [ ] `createProduct` and `updateProduct` usecases implemented and tested
-   [ ] `useCreateProduct` and `useUpdateProduct` mutation hooks implemented
-   [ ] `ProductsTable` component created with proper styling and accessibility
-   [ ] `ProductForm` component created with proper styling and accessibility
-   [ ] `CatalogPage` displays products list with "Add Product" button
-   [ ] `NewProductPage` allows creating new products
-   [ ] `EditProductPage` allows editing existing products
-   [ ] All components follow project conventions (arrow functions, type props, memoization)
-   [ ] All styles use variables from `styles/variables/*` (no hardcoded values)
-   [ ] All components are accessible (ARIA labels, semantic HTML, error announcements)
-   [ ] Unit tests for usecases pass
-   [ ] Build/lint green
-   [ ] No TypeScript errors
-   [ ] Code review approved

## Related Components

### Domain & Usecases

-   `src/core/domain/product.ts` - Product type definition
-   `src/core/domain/validation.ts` - Product validation (`isValidProduct`)
-   `src/core/usecases/product.ts` - Product usecases (add `createProduct`, `updateProduct`)
-   `__tests__/core/usecases/product.test.ts` - Product usecase tests

### Infrastructure

-   `src/core/ports/productRepository.ts` - ProductRepository interface
-   `src/infrastructure/supabase/productRepositorySupabase.ts` - Repository implementation (already has create/update)

### Presentation - Hooks

-   `src/presentation/hooks/useProducts.ts` - Product hooks (add mutations)
-   `src/presentation/hooks/queryKeys.ts` - Query keys

### Presentation - Components

-   `src/presentation/components/catalog/ProductsTable/ProductsTable.tsx` - Products table component (new)
-   `src/presentation/components/catalog/ProductsTable/ProductsTable.module.scss` - Table styles (new)
-   `src/presentation/components/catalog/ProductForm/ProductForm.tsx` - Product form component (new)
-   `src/presentation/components/catalog/ProductForm/ProductForm.module.scss` - Form styles (new)
-   `src/app/dashboard/catalog/page.tsx` - Catalog page (update)
-   `src/app/dashboard/catalog/page.module.scss` - Catalog page styles (new)
-   `src/app/dashboard/catalog/new/page.tsx` - New product page (new)
-   `src/app/dashboard/catalog/new/page.module.scss` - New product page styles (new)
-   `src/app/dashboard/catalog/[id]/edit/page.tsx` - Edit product page (new)
-   `src/app/dashboard/catalog/[id]/edit/page.module.scss` - Edit product page styles (new)

### Reference Components (Similar Patterns)

-   `src/app/dashboard/activities/page.tsx` - Activities page (reference for structure)
-   `src/presentation/components/activities/ActivitiesTable/ActivitiesTable.tsx` - Activities table (reference)
-   `src/presentation/hooks/useActivities.ts` - Activities hooks (reference for query patterns)
-   `src/presentation/hooks/useAuth.ts` - Auth hooks (reference for mutation patterns)

## Dependencies

-   Product domain model (already exists)
-   Product repository with create/update methods (already exists)
-   React Query setup (already exists)
-   UI components (Button, Input, Select, Heading, Text, Link) from design system (already exist)

## Notes

-   This ticket focuses on the core CRUD functionality. Search, filtering, and pagination can be added in future tickets.
-   Product deletion can be added in a future ticket if needed.
-   The form should handle all Product fields including the optional `weight` field.
-   Consider adding a `getProductById` usecase and hook if not already needed for the edit page.
