---
Generated: 2025-01-27 20:30:00
Ticket Number: 26
---

# Improve product selection in add activity form with cascading dropdowns (Type → Model → Coloris)

-   Type: Feature
-   Priority: Medium
-   Story Points: 8
-   Labels: ui, forms, products, activity, user-experience
-   Git Branch: feat/fbc-26-cascading-product-selection

## Description

Replace the single "Product" select dropdown in the add activity form with three cascading dropdowns to improve user experience and make product selection more intuitive. The new flow will be: Product Type → Product Model → Coloris. If only one coloris is available for the selected model, it should be automatically selected.

**Current state:**

-   Add activity form has a single "Product" select that displays all products: `"Charlie - Rose pâle à motifs (POCHETTE_VOLANTS)"`
-   Product selection is difficult when there are many products with similar names
-   No filtering or grouping by product type or model
-   Users must scroll through a long list to find the right product

**Business requirement:**

-   Users need to select products more easily by first choosing the product type
-   Then selecting the model (filtered by type)
-   Finally selecting the coloris (filtered by model)
-   If only one coloris is available, it should be auto-selected for better UX
-   Each product is uniquely identified by the combination: `modelId` + `colorisId`

**Infrastructure already available:**

✅ **FBC-26 (Product Reference Tables) has already been implemented**, providing:

-   Reference tables (`product_models`, `product_coloris`) with proper foreign keys
-   Repository methods: `listModelsByType`, `listColorisByModel`
-   Usecases: `listProductModelsByType`, `listProductColorisByModel`
-   React Query hooks: `useProductModelsByType`, `useProductColorisByModel`

**This ticket (FBC-26) focuses on:**

-   Explaining the UX improvement and business value
-   Documenting the user story and acceptance criteria
-   Providing context for ticket #27 (implementation)

**Example flow:**

1.  User selects Type: "POCHETTE_VOLANTS"
2.  System fetches models for this type using `useProductModelsByType` hook → Shows: "Charlie"
3.  User selects Model: "Charlie" (modelId)
4.  System fetches coloris for this model using `useProductColorisByModel` hook → Shows: "Rose pâle à motifs", "Rose marsala"
5.  If only one coloris exists, it's auto-selected
6.  Final selection: System finds `productId` by matching `modelId` + `colorisId` in products table

## User Story

**As a** user creating an activity  
**I want** to select products using cascading dropdowns (Type → Model → Coloris)  
**So that** I can quickly find and select the exact product I need without scrolling through a long list

## Implementation

**Ticket #27** implements the UI changes for this feature:

-   Updates `AddActivityForm` component with three cascading Select dropdowns
-   Uses existing hooks from FBC-26: `useProductModelsByType`, `useProductColorisByModel`
-   Implements cascading filter logic (type → model → coloris)
-   Maps final selection to `productId` for form submission

**Why ticket #27 is needed:**

The infrastructure (hooks, usecases, repository methods) already exists from FBC-26 (Product Reference Tables), but the `AddActivityForm` component still uses the old single-select approach. Ticket #27 updates the UI to leverage the existing infrastructure and provide the improved UX described in this ticket.

## Related Components

**Already implemented (FBC-26):**

-   ✅ `src/core/usecases/product.ts` - Contains `listProductModelsByType`, `listProductColorisByModel`
-   ✅ `src/core/ports/productRepository.ts` - Contains `listModelsByType`, `listColorisByModel`
-   ✅ `src/infrastructure/supabase/productRepositorySupabase.ts` - Implements repository methods
-   ✅ `src/presentation/hooks/useProducts.ts` - Contains `useProductModelsByType`, `useProductColorisByModel`

**To be implemented (Ticket #27):**

-   `src/presentation/components/addActivity/AddActivityForm/AddActivityForm.tsx` - Update with cascading selects

## Dependencies

-   ✅ **FBC-26 (Product Reference Tables)** - **MUST be completed first** (already implemented)
    -   Provides reference tables (`product_models`, `product_coloris`)
    -   Provides hooks and usecases for fetching models and coloris
-   Ticket #14 (Add Activity page) - Must be completed first
-   Products must exist in database with `model_id` and `coloris_id` foreign keys (from FBC-26)

## Notes

-   **This ticket documents the UX improvement and business value**
-   **Ticket #27 implements the UI changes** using the existing infrastructure from FBC-26
-   This is a UX improvement that makes product selection more intuitive
-   The current single-select approach works but becomes cumbersome with many products
-   Cascading dropdowns are a common pattern for hierarchical data selection
-   Auto-selection of unique coloris improves UX by reducing clicks
-   Stock management remains unchanged - each product (`modelId` + `colorisId`) has its own stock
-   **No backend work needed** - All infrastructure already exists from FBC-26
