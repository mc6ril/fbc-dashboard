---
Generated: 2025-01-27 [timestamp]
Ticket Number: 21
---

# Add weight field to Product domain model

-   Type: Feature
-   Priority: Medium
-   Story Points: 2
-   Labels: domain, database, schema, product, logistics
-   Git Branch: feat/fbc-21-add-product-weight

## Description

Add a `weight` (poids) field to the Product domain model to track product weight in grams. This field is essential for:

-   **Shipping cost calculation**: Calculate accurate shipping fees for online sales
-   **Logistics management**: Optimize package preparation and shipping
-   **Product information**: Provide weight information to customers
-   **Cost analysis**: Calculate real shipping costs for profitability analysis

**Business requirement:**

-   Products need weight information for shipping calculations
-   Weight is stored in grams for precision and compatibility with shipping carriers
-   Field is optional to allow products without weight initially

## User Story

As a user, I want to track product weight so that I can calculate accurate shipping costs and provide complete product information to customers.

## Acceptance Criteria

-   [ ] Add `weight` field to `Product` type in `src/core/domain/product.ts`
-   [ ] Field is optional (`weight?: number`) - allows products without weight
-   [ ] Field represents weight in grams (NUMERIC(6, 2) in database)
-   [ ] Update JSDoc documentation for Product type
-   [ ] Create SQL migration to add `weight` column to `products` table
-   [ ] Migration adds column as `NUMERIC(6, 2)` with CHECK constraint (weight > 0 if not NULL)
-   [ ] Update `isValidProduct` validation function to validate weight if present (must be > 0)
-   [ ] Update all Product test fixtures to optionally include weight field
-   [ ] Add tests for weight field validation (positive, optional)
-   [ ] Update existing tests to ensure they pass with optional weight field
-   [ ] All linting and type checks pass

## Technical Considerations

-   **Domain layer**: Add `weight?: number` to `Product` type (optional field)
-   **Database**: Add `weight NUMERIC(6, 2) CHECK (weight > 0)` column to `products` table
-   **Unit**: Weight stored in grams (allows precision for small textile accessories)
-   **Validation**: If weight is provided, it must be positive (> 0)
-   **Migration strategy**:
    -   Column is nullable (no NOT NULL constraint)
    -   Existing products can have NULL weight
    -   New products can be created without weight
-   **Future considerations**: May need weight for shipping calculations in Activity/Sale entities

## Database Migration

Create migration file: `src/infrastructure/supabase/migrations/003_add_weight_to_products.sql`

-- Add weight column to products table (in grams)
ALTER TABLE products
ADD COLUMN weight NUMERIC(6, 2) CHECK (weight IS NULL OR weight > 0);

-- Add comment for documentation
COMMENT ON COLUMN products.weight IS 'Product weight in grams. Optional field for shipping calculations.';## Definition of Done

-   [ ] `Product` type includes `weight?: number` field
-   [ ] SQL migration created and tested
-   [ ] Migration applied to Supabase dev database
-   [ ] All domain tests updated and passing
-   [ ] Validation function updated and tested (optional weight, must be > 0 if present)
-   [ ] JSDoc documentation updated
-   [ ] Build/lint green
-   [ ] No TypeScript errors

## Related Components

-   `src/core/domain/product.ts` - Product type definition
-   `src/core/domain/validation.ts` - Product validation
-   `__tests__/core/domain/product.test.ts` - Product tests
-   `__tests__/core/domain/validation.test.ts` - Validation tests
-   `src/infrastructure/supabase/migrations/003_add_weight_to_products.sql` - Database migration
-   `src/infrastructure/supabase/migrations/001_create_domain_tables.sql` - Reference for table structure

## Examples

Weight examples for textile accessories:

-   Sac banane: ~150-200 grams
-   Pochette ordinateur: ~100-150 grams
-   Trousse de toilette: ~80-120 grams
-   Pochette à volants: ~50-80 grams
-   Trousse zippée: ~60-100 grams
-   Accessoires divers: ~10-50 grams

## Future Enhancements

-   Calculate shipping costs based on product weight in Activity/Sale entities
-   Add weight-based shipping fee calculation in usecases
-   Display weight in product catalog UI
-   Weight-based inventory management (total weight of stock)
