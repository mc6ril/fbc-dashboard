---
Generated: 2025-01-27 20:30:00
Ticket Number: 27
Parent Ticket: 26
---

# Update AddActivityForm with cascading product selects (UI layer)

-   Type: Feature
-   Priority: Medium
-   Story Points: 5
-   Labels: ui, forms, products, activity, components
-   Git Branch: feat/fbc-27-cascading-product-selects-ui

## Description

Implement cascading product selection in **AddActivityForm** component (formulaire "Ajouter une activité") using the infrastructure from FBC-26 (Product Reference Tables). Replace the single "Product" select with three cascading selects: Product Type → Product Model → Coloris.

**Note:** ProductForm (formulaire "Ajouter un produit") already has cascading dropdowns implemented. This ticket brings the same UX to AddActivityForm.

**See ticket #26 for business context and user story.**

**This ticket implements the UI layer only** - all backend infrastructure (hooks, usecases, repository methods) already exists from FBC-26.

## Acceptance Criteria

-   [ ] Replace single "Product" select with three selects: Product Type, Product Model, Coloris
-   [ ] Product Type select shows all available product types from `ProductType` enum (POCHETTE_VOLANTS, SAC_BANANE, etc.)
-   [ ] Product Model select uses `useProductModelsByType` hook (from FBC-26)
    -   Shows models for the selected type (fetched from `product_models` table)
    -   Disabled when no type is selected
    -   Reset when type changes
    -   Shows loading state while fetching
-   [ ] Coloris select uses `useProductColorisByModel` hook (from FBC-26)
    -   Shows coloris for the selected model (fetched from `product_coloris` table)
    -   Disabled when no type or model is selected
    -   Reset when type or model changes
    -   Shows loading state while fetching
-   [ ] Auto-select coloris if only one is available for the selected model
-   [ ] Final product selection correctly maps to `productId` by finding product with matching `modelId` + `colorisId`
    -   Query `products` table to find product where `model_id = selectedModelId` AND `coloris_id = selectedColorisId`
-   [ ] Form validation ensures all three fields are selected when product is required
-   [ ] All three selects are properly labeled and accessible (WCAG 2.1 AA)
-   [ ] Form maintains existing functionality for activity creation
-   [ ] Component uses SCSS variables for all styling (no hardcoded values)
-   [ ] Component is memoized appropriately
-   [ ] Component has proper TypeScript types

## Technical Implementation

**Key points:**

-   Use existing hooks: `useProductModelsByType(type)`, `useProductColorisByModel(modelId)`
-   Use `useProducts()` hook to find `productId` from `modelId` + `colorisId` combination
-   Implement cascading reset: type change → clear model/coloris, model change → clear coloris
-   Auto-select coloris if only one available
-   Show loading states while fetching

**Implementation pattern:**

```typescript
// State
const [selectedProductType, setSelectedProductType] = useState<ProductType | null>(null);
const [selectedModelId, setSelectedModelId] = useState<ProductModelId | null>(null);
const [selectedColorisId, setSelectedColorisId] = useState<ProductColorisId | null>(null);

// Fetch data using FBC-26 hooks
const { data: models } = useProductModelsByType(selectedProductType);
const { data: coloris } = useProductColorisByModel(selectedModelId);
const { data: products } = useProducts();

// Find productId from modelId + colorisId
const productId = useMemo(() => {
    if (!selectedModelId || !selectedColorisId || !products) return undefined;
    return products.find((p) => p.modelId === selectedModelId && p.colorisId === selectedColorisId)?.id;
}, [products, selectedModelId, selectedColorisId]);
```

## Definition of Done

-   [ ] All acceptance criteria met
-   [ ] Component tested and lint/build passes
-   [ ] Component documented with JSDoc

## Related Components

-   `src/presentation/components/addActivity/AddActivityForm/AddActivityForm.tsx` - **Component to update** (formulaire "Ajouter une activité")
-   `src/presentation/components/catalog/ProductForm/ProductForm.tsx` - **Reference implementation** (déjà implémenté avec cascading dropdowns)
-   `src/presentation/hooks/useProducts.ts` - Use existing hooks: `useProductModelsByType`, `useProductColorisByModel`

## Dependencies

-   ✅ **Ticket #26 (FBC-26)**: Product reference tables - **Already implemented** (provides all hooks and infrastructure)
-   Ticket #14 (Add Activity page) - Must be completed first

## Notes

-   **See ticket #26 for business context and user story**
-   All backend infrastructure already exists from FBC-26 (hooks, usecases, repository methods)
-   This ticket only implements the UI layer in AddActivityForm component
-   Use `useProducts()` hook to find `productId` from `modelId` + `colorisId` (filter in-memory)
