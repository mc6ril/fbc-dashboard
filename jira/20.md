---
Generated: 2025-01-27 [timestamp]
Ticket Number: 20
---

# Add coloris field to Product domain model

-   Type: Feature
-   Priority: High
-   Story Points: 3
-   Labels: domain, database, schema, product
-   Git Branch: feat/fbc-20-add-product-coloris

## Description

Add a `coloris` (color) field to the Product domain model to track product color variations. Based on real business data, products can have multiple color variations (e.g., "Rose pâle à motifs", "Rose marsala", "Prune", "Rouge", "Pêche", "Rose") for the same model and type.

**Current structure:**

-   `Product.name` = Modèle (e.g., "Charlie", "Assumée", "Espiègle")
-   `Product.type` = Article/Type (e.g., "Pochette à volants", "Sac banane")
-   **Missing:** `coloris` field

**Business requirement:**

-   Multiple models (name) can exist for the same product type (article)
-   Each model can have multiple color variations (coloris)
-   Example: "Pochette à volants" (type) can have "Charlie" (model) in "Rose pâle à motifs" (coloris) and "Rose marsala" (coloris)

## User Story

As a user, I want to track product color variations so that I can manage inventory and sales for different color options of the same product model.

## Acceptance Criteria

-   [ ] Add `coloris` field to `Product` type in `src/core/domain/product.ts`
-   [ ] Field is required (NOT NULL) - all products must have a coloris
-   [ ] Field is a string (TEXT) to allow flexible color descriptions
-   [ ] Update JSDoc documentation for Product type
-   [ ] Create SQL migration to add `coloris` column to `products` table
-   [ ] Migration adds column as `TEXT NOT NULL` with appropriate default or backfill strategy
-   [ ] Update `isValidProduct` validation function to include coloris validation
-   [ ] Update all Product test fixtures to include coloris field
-   [ ] Add tests for coloris field validation
-   [ ] Update existing tests to ensure they pass with new field
-   [ ] All linting and type checks pass

## Technical Considerations

-   **Domain layer**: Add `coloris: string` to `Product` type
-   **Database**: Add `coloris TEXT NOT NULL` column to `products` table
-   **Migration strategy**:
    -   For existing data: Set a default value (e.g., "Non spécifié") or make it nullable temporarily, then backfill
    -   For new data: Require coloris at creation
-   **Validation**: Ensure coloris is a non-empty string
-   **Backward compatibility**: Consider migration path for existing products if any

## Database Migration

Create migration file: `src/infrastructure/supabase/migrations/002_add_coloris_to_products.sql`

-- Add coloris column to products table
ALTER TABLE products
ADD COLUMN coloris TEXT NOT NULL DEFAULT 'Non spécifié';

-- Remove default after backfilling existing data (if needed)
-- ALTER TABLE products ALTER COLUMN coloris DROP DEFAULT;## Definition of Done

-   [ ] `Product` type includes `coloris: string` field
-   [ ] SQL migration created and tested
-   [ ] Migration applied to Supabase dev database
-   [ ] All domain tests updated and passing
-   [ ] Validation function updated and tested
-   [ ] JSDoc documentation updated
-   [ ] Build/lint green
-   [ ] No TypeScript errors

## Related Components

-   `src/core/domain/product.ts` - Product type definition
-   `src/core/domain/validation.ts` - Product validation
-   `__tests__/core/domain/product.test.ts` - Product tests
-   `__tests__/core/domain/validation.test.ts` - Validation tests
-   `src/infrastructure/supabase/migrations/002_add_coloris_to_products.sql` - Database migration
-   `src/infrastructure/supabase/migrations/001_create_domain_tables.sql` - Reference for table structure

## Examples

Based on real business data:

-   Product: type="POCHETTE_VOLANTS", name="Charlie", coloris="Rose pâle à motifs"
-   Product: type="POCHETTE_VOLANTS", name="Charlie", coloris="Rose marsala"
-   Product: type="SAC_BANANE", name="Assumée", coloris="Prune"
-   Product: type="SAC_BANANE", name="Espiègle", coloris="Rouge"
-   Product: type="POCHETTE_ORDINATEUR", name="Assumée", coloris="Rose"
-   Product: type="POCHETTE_ORDINATEUR", name="Espiègle", coloris="Pêche"
