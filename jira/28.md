---
Generated: 2025-01-27 20:30:00
Ticket Number: 28
Parent Ticket: 26
---

# Add product filtering repository methods (Infrastructure layer)

-   Type: Feature
-   Priority: Low
-   Story Points: 2
-   Labels: infrastructure, repository, products, filtering, optimization
-   Git Branch: feat/fbc-28-product-filtering-repository

## Description

Add repository-level filtering methods for products to optimize performance. This is an optional optimization ticket that can be implemented after ticket #27 if performance becomes an issue with in-memory filtering.

**Current state:**
-   `ProductRepository` has `list()` method that returns all products
-   Filtering is done in-memory in usecases (ticket #27)
-   No repository-level filtering exists

**Business requirement:**
-   For large product catalogs, filtering at database level is more efficient
-   Reduces memory usage by not loading all products
-   Improves query performance with database indexes

## User Story

**As a** system  
**I want** product filtering at repository level  
**So that** queries are optimized for large product catalogs

## Acceptance Criteria

-   [ ] Add `listByType` method to `ProductRepository` interface in `src/core/ports/productRepository.ts`
    -   Takes `ProductType` as parameter
    -   Returns `Promise<Product[]>` with products matching the type
    -   Documented with JSDoc
-   [ ] Implement `listByType` in `productRepositorySupabase` in `src/infrastructure/supabase/productRepositorySupabase.ts`
    -   Uses Supabase query with `.eq('type', type)` filter
    -   Maps Supabase rows to domain Product types
    -   Handles errors appropriately
-   [ ] Add `listByTypeAndName` method to `ProductRepository` interface
    -   Takes `ProductType` and `name: string` as parameters
    -   Returns `Promise<Product[]>` with products matching type + name
    -   Documented with JSDoc
-   [ ] Implement `listByTypeAndName` in `productRepositorySupabase`
    -   Uses Supabase query with `.eq('type', type).eq('name', name)` filters
    -   Maps Supabase rows to domain Product types
    -   Handles errors appropriately
-   [ ] Update usecases from ticket #27 to use new repository methods (optional optimization)
-   [ ] All methods properly typed with TypeScript
-   [ ] All methods documented with JSDoc

## Technical Considerations

**Clean Architecture:**
-   Ports layer (`core/ports/`) - Add methods to interface
-   Infrastructure layer (`infrastructure/supabase/`) - Implement Supabase queries

**Supabase queries:**
```typescript
// listByType
supabase.from('products').select('*').eq('type', type)

// listByTypeAndName
supabase.from('products').select('*').eq('type', type).eq('name', name)
```

**Performance:**
-   Database-level filtering is more efficient for large datasets
-   Can leverage database indexes on `type` and `name` columns
-   Reduces memory usage by not loading all products

## Definition of Done

-   [ ] Repository methods added to `ProductRepository` interface
-   [ ] Repository methods implemented in `productRepositorySupabase`
-   [ ] Methods properly typed with TypeScript
-   [ ] Methods documented with JSDoc
-   [ ] Methods tested (unit tests in `__tests__/core/infrastructure/supabase/productRepositorySupabase.test.ts`)
-   [ ] Lint/build passes
-   [ ] Usecases updated to use new methods (optional)

## Related Components

-   `src/core/ports/productRepository.ts` - Interface to update
-   `src/infrastructure/supabase/productRepositorySupabase.ts` - Implementation to add
-   `src/core/usecases/product.ts` - May update to use new methods
-   `__tests__/core/infrastructure/supabase/productRepositorySupabase.test.ts` - Tests to add

## Dependencies

-   Ticket #27 (Product filtering usecases) - Should be completed first
-   Database indexes on `type` and `name` columns recommended for performance

## Notes

-   This is an **optional optimization ticket**
-   Can be skipped if product catalog remains small (< 1000 products)
-   In-memory filtering (ticket #27) is acceptable for small to medium datasets
-   Implement this ticket if performance becomes an issue
-   Database indexes should be added for optimal performance

